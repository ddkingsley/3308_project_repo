<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
canvas {
    border: 1px solid #d3d3d3;
    background-color: #fafafa;
}
</style>
</head>
<body onload="startGame()">
<script>
//These are the racing blocks!
var object_1;
var object_2;
var object_3;
var object_4;
var object_5;

var player_choice = 0; //player_choice acts as a busy signal to disable the buttons 0 is open 1 is closed
var bounce_bool = 1;
//game dimensions, change these to easilly alter the aspect ratios in the game
var block_height = 30;
var block_width = 30;
var area_width = 480;
var area_height = 270;

var turtle = new Image();
//turtle.src = "{{url_for('static', filename='images/turtle.png') }}";
turtle.src = "turtle.png";

function startGame() {
    myGameArea.init();
    object_1 = new component(block_width, block_height, "red", 10, 37);
    object_2 = new component(block_width, block_height, "blue", 10, 75);
    object_3 = new component(block_width, block_height, "purple", 10, 115);
    object_4 = new component(block_width, block_height, "yellow", 10, 155);
    object_5 = new component(block_width, block_height, "pink", 10, 191);
    Lines = new lines(area_width, 2, "black");
    console.log(object_1.x);
    console.log(area_width);
    console.log("inside StartGame()")
    object_1.update();
    object_2.update();
    object_3.update();
    object_4.update();
    object_5.update();
    object_1.tag();
    object_2.tag();
    object_3.tag();
    object_4.tag();
    object_5.tag();
    Lines.update();
}

var myGameArea = {
    canvas : document.createElement("canvas"),
    init : function() {
        this.canvas.width = area_width;
        this.canvas.height = area_height;
        this.context = this.canvas.getContext("2d");
        document.body.insertBefore(this.canvas, document.body.childNodes[0]);

    },
    start : function() {
        this.interval = setInterval(Render, 10);
    },
    clear : function() {
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    },
    stop : function() {
        clearInterval(this.interval);
    }
}
function lines(width, height, color) {
    this.width = width;
    this.height = height;
    this.update = function(){
        ctx = myGameArea.context;
        ctx.fillStyle = color;
        for (i = 1; i < 7; i++) {
            ctx.fillRect(0, (i*36), this.width, this.height);
        }
        
    }
}
function component(width, height, color, x, y) {
    this.width = width;
    this.height = height;
    this.x = x;
    this.y = y;
    this.pc = 0;
    this.update = function(){
        ctx = myGameArea.context;
        //ctx.fillStyle = color;
        //ctx.fillRect(this.x, this.y, this.width, this.height);
        ctx.drawImage(turtle,this.x,this.y);
    },
    this.tag = function(){
        ctx = myGameArea.context;
        ctx.fillStyle = color;
        ctx.fillRect(0, this.y, 10, this.height);
    }
}
//var random_answer_index = Math.floor(Math.random() * answers_length)

function victory_condition(block) {
    if (block.x >= (area_width - block_width)) {
        myGameArea.stop();
        if (block.pc == 1) {
            alert("Congratulations, your wish will surely come true!")
        }
        else {
            alert("Sorry but your block did not win and your wish may not come true just yet")
        }
        //this would be where I would create a reset button to play again
        resetButton = document.createElement('button')
        resetButton.innerHTML = "Reset Game";
        document.body.appendChild(resetButton);
        resetButton.addEventListener('click', Reset)
        /*
            answerButton = document.createElement('button')
	        answerButton.innerHTML = "Give me ze answer!";
	        document.body.appendChild(answerButton)
	        answerButton.addEventListener('click', get_answer)
        */
    }
}
function Reset() {
    player_choice = 0;
    myGameArea.clear();
    startGame();
    document.body.removeChild(resetButton);
}


function Render() {
    myGameArea.clear();
    /*
    object_1.x += Math.floor(Math.random() *3);
    object_2.x += Math.floor(Math.random() *3);
    object_3.x += Math.floor(Math.random() *3);
    object_4.x += Math.floor(Math.random() *3);
    object_5.x += Math.floor(Math.random() *3);
    */
    bounce_bool = bounce_bool * -1;
    object_1.x += Math.random();
    object_2.x += Math.random();
    object_3.x += Math.random();
    object_4.x += Math.random();
    object_5.x += Math.random();
    object_1.y += bounce_bool;
    object_2.y += bounce_bool;
    object_3.y += bounce_bool;
    object_4.y += bounce_bool;
    object_5.y += bounce_bool;
    object_1.update();
    object_2.update();
    object_3.update();
    object_4.update();
    object_5.update();
    object_1.tag();
    object_2.tag();
    object_3.tag();
    object_4.tag();
    object_5.tag();
    Lines.update();
    victory_condition(object_1);
    victory_condition(object_2);
    victory_condition(object_3);
    victory_condition(object_4);
    victory_condition(object_5);
}
function choose_block(selection) {
    //players can currently change their choice while game is running and have multiple blocks
    if (player_choice == 0) {
        player_choice = 1; //player_choice acts as a busy signal to disable the buttons
        if (selection == 1) {
            object_1.pc = 1;
        }
        else if (selection == 2) {
            object_2.pc = 1;
        }
        else if (selection == 3) {
            object_3.pc = 1;
        }
        else if (selection == 4) {
            object_4.pc = 1;
        }
        else if (selection == 5) {
            object_5.pc = 1;
        }
        myGameArea.start();
    }
}
//<button onclick="moveup()">UP</button>
//<button onclick="movedown()">DOWN</button>
//<button onclick="moveleft()">LEFT</button>
//<button onclick="moveright()">RIGHT</button>
</script>

<p>Pick your Turtle! Current options:</p>
<button onclick="choose_block(1)">Red</button>
<button onclick="choose_block(2)">Blue</button>
<button onclick="choose_block(4)">Yellow</button>
<button onclick="choose_block(5)">Pink</button>
<button onclick="choose_block(3)">Purple</button>


</body>
</html>